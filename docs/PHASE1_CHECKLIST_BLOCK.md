# Phase 1 — Foundation Hardening Checklist (AUTO/MANUAL, Ungameable)

**Purpose:** Phase 1 proves deterministic, fail-closed order-intent foundations before higher-level policy/strategy controls.

**Rule:** Phase 1 is DONE only if every item below is satisfied with required evidence.

Canonical narrative: `docs/phase1_acceptance.md`.
If this checklist and another Phase 1 narrative differ, this checklist is the gating source of truth.

## Phase 1 Evidence Pack (required)

Create/maintain `evidence/phase1/` with the following required files:

```text
evidence/phase1/
  README.md
  ci_links.md
  restart_loop/
    restart_100_cycles.log
  determinism/
    intent_hashes.txt
  no_side_effects/
    rejection_cases.md
  traceability/
    sample_rejection_log.txt
  config_fail_closed/
    missing_keys_matrix.json
  crash_mid_intent/
    auto_test_passed.txt OR drill.md
```

- `README.md`: one-page owner summary (what was proven, what failed, remaining risks).
- `ci_links.md`: links/build IDs for each AUTO gate.
- Artifact files must be generated by tests or recorded drill evidence (not hand-wavy placeholders).

## P1-A — Single Dispatch Chokepoint Proof (No Bypass Paths)

**MANUAL artifact required:**
- `docs/dispatch_chokepoint.md` with exact chokepoint module/function and explicit no-bypass statement.

**AUTO gates:**
- `test_dispatch_chokepoint_no_direct_exchange_client_usage`
- `test_dispatch_visibility_is_restricted`

**Unblock condition:** both AUTO tests green and manual doc present/accurate.

## P1-B — Determinism Snapshot Test (Same Inputs => Same Intent Bytes/Hash)

**AUTO gate:**
- `test_intent_determinism_same_inputs_same_hash`

Must assert same serialized intent/hash across:
- repeated runs,
- restart/process boundary,
- map iteration reorder.

**Required evidence:**
- `evidence/phase1/determinism/intent_hashes.txt`

**Unblock condition:** AUTO test green and artifact emitted.

## P1-C — No Partial Side Effects on Rejection

**AUTO gate:**
- `test_rejected_intent_has_no_side_effects`

Must prove rejected intent causes no persistent side effects (WAL/orders/positions/pending exposure unchanged; counters/logs allowed).

**MANUAL evidence:**
- `evidence/phase1/no_side_effects/rejection_cases.md` (>=3 rejection cases + CI links)

**Unblock condition:** AUTO test green and rejection-cases doc present.

## P1-D — intent_id / run_id Propagation Contract

**AUTO gate:**
- `test_intent_id_propagates_to_logs_and_metrics`

**Required evidence:**
- `evidence/phase1/traceability/sample_rejection_log.txt`

**Unblock condition:** AUTO test green and artifact emitted.

## P1-E — Gate Ordering Constraints (Invariant Enforcement)

**MANUAL artifact required:**
- `docs/intent_gate_invariants.md` with normative invariants:
  - reject-only gates before persistent side effects,
  - durable record before dispatch,
  - no side effects before final accept/commit.

**AUTO gate:**
- `test_gate_ordering_constraints`

**Unblock condition:** AUTO test green and invariants doc present.

## P1-F — Fail-Closed Defaults for Missing Config

**MANUAL artifact required:**
- `docs/critical_config_keys.md` listing critical Phase 1 keys and deterministic reject behavior.

**AUTO gate:**
- `test_missing_config_fails_closed`

Must prove each missing key causes deterministic rejection and no persistent side effects.

**Required evidence:**
- `evidence/phase1/config_fail_closed/missing_keys_matrix.json`

**Unblock condition:** AUTO test green, matrix emitted, critical-keys doc present.

## P1-G — Minimal Crash-Mid-Intent Proof

**AUTO preferred gate:**
- `test_crash_mid_intent_no_duplicate_dispatch`

**If AUTO not feasible yet, one-time MANUAL fallback:**
- `evidence/phase1/crash_mid_intent/drill.md` with trigger, restart steps, and proof of:
  - no duplicate dispatch,
  - no ghost persistent state,
  - no unsafe OPEN after restart.

**Unblock condition:** AUTO test green OR manual drill artifact present with concrete proof.

## Phase 1 Runtime Guarantees (minimum)

Phase 1 is not complete unless all are true:
- No duplicate dispatch across crash/restart/reconnect.
- No OPEN risk created when WAL enqueue fails.
- No OPEN risk created when sizing metadata is stale/missing.
- No OPEN risk created when `RiskState != Healthy`.
- Illegal orders are rejected before exchange dispatch.

## Phase 1 Owner Sign-Off (Binary)

Answer YES/NO with links to `evidence/phase1/`:

1. Can any code path dispatch without the chokepoint?
2. Do identical frozen inputs produce identical intent bytes/hashes across restart?
3. Can rejected intents leave persistent side effects?
4. Are intent-handling logs/metrics traceable by shared `intent_id` + `run_id`?
5. Do missing critical config keys fail closed with deterministic reject reasons?

If any answer is "I think so," Phase 1 is NOT DONE.

## Explicit Phase 1 Non-Goals (Do Not Backport)

- No full `/status` endpoint/schema/reason-code surface.
- No PolicyGuard/TradingMode precedence ladder as completion criteria.
- No replay/evidence governance loop beyond Phase 1 required artifacts.
- No dashboards/UI.
- No broad chaos suite beyond minimal crash-mid-intent proof.
