$ ./plans/verify.sh quick
[exit=0] [elapsed_s=1529.269]

=== STDOUT ===
VERIFY_SH_SHA=49f1e5d95e48383ffdfcd2b4b5e78e2e8fa404453562cfe784e5fb424950010a

[0;32m=== 0) Repo sanity ===[0m
mode=quick verify_mode=none root=/private/tmp/phase1-compare-full-20260213/ralph
verify_run_id=20260213_114252 artifacts_dir=/private/tmp/phase1-compare-full-20260213/ralph/artifacts/verify/20260213_114252
info: change_detection_ok=1 files=12 base_ref=origin/main

[0;32m=== 0.1) Workflow preflight ===[0m
[PASS] Git repository
[PASS] Tool: git
[PASS] Tool: jq
[PASS] Tool: bash
[PASS] File: PRD file
[PASS] File: Contract spec
[PASS] Shell syntax (plans/*.sh)
[PASS] PRD schema validation
[PASS] Postmortem check

preflight: 9 passed, 0 failed, 0 warnings

[0;32m=== 0a) Parallel primitives smoke test ===[0m
Running parallel verify smoke test...
Verifying bash syntax and structural changes...
[OK] run_parallel_group() function exists
[OK] Parallel execution flags exist
[OK] Spec validators converted to parallel array
[OK] workflow_acceptance invoked via run_logged
[OK] Timing instrumentation exists
[OK] detect_cpus() exists
[OK] Spec validators use parallel runner
[OK] Status fixtures use parallel runner
[OK] Unbound variable guards present
[OK] Timeout precedence fix present
[OK] Smoke test integrated via run_logged
[OK] parallel acceptance integration marker present
[OK] eval removed from command execution

[OK] All smoke tests passed

[0;32m=== 0b) Contract coverage matrix ===[0m
info: contract coverage skipped (no relevant changes detected)

[0;32m=== 0c) Spec integrity gates ===[0m
PASS: no cross-reference issues found.
OK: ARCH_FLOW_INDEX checks passed.
INVARIANTS OK
STATE MACHINES OK
OK: CRASH_MATRIX.md looks mechanically consistent.
OK: time/freshness spec checks passed.
OK: crash/replay/idempotency spec checks passed.
OK: RECONCILIATION_MATRIX checks passed.
CSP Trace Validation
====================
Contract: specs/CONTRACT.md
Trace: specs/TRACE.yaml

Coverage: 100.0%
  Total clauses: 9
  Fully mapped: 1
  Partial: 8
  Unmapped: 0

PASS: No errors found

[0;32m=== 0d) Status contract validation (CSP) ===[0m
VALIDATION OK: tests/fixtures/status/market_data_stale.json
VALIDATION OK: tests/fixtures/status/partial_fill_containment.json
VALIDATION OK: tests/fixtures/status/restart_reconcile.json
VALIDATION OK: tests/fixtures/status/session_termination.json
VALIDATION OK: tests/fixtures/status/unknown_token_force_kill.json
VALIDATION OK: tests/fixtures/status/wal_backpressure.json
âœ“ validated 6 status fixture(s)

[0;32m=== 1) Endpoint-level test gate ===[0m
info: endpoint gate skipped (no endpoint-affecting changes detected)

[0;32m=== 1b) PR postmortem gate ===[0m
postmortem check: OK

[0;32m=== 1c) Rust vendor docs lint ===[0m
OK: Cargo.lock unchanged; skipping vendor docs lint.

[0;32m=== 2a) Rust format ===[0m

[0;32m=== 2c) Rust tests ===[0m
   Compiling proc-macro2 v1.0.106
   Compiling unicode-ident v1.0.23
   Compiling quote v1.0.44
   Compiling serde_core v1.0.228
   Compiling zmij v1.0.20
   Compiling serde v1.0.228
   Compiling serde_json v1.0.149
   Compiling itoa v1.0.17
   Compiling memchr v2.8.0
   Compiling soldier_core v0.1.0 (/private/tmp/phase1-compare-full-20260213/ralph/crates/soldier_core)
   Compiling syn v2.0.114
   Compiling serde_derive v1.0.228
   Compiling soldier_infra v0.1.0 (/private/tmp/phase1-compare-full-20260213/ralph/crates/soldier_infra)
    Finished `test` profile [unoptimized + debuginfo] target(s) in 25.30s
     Running unittests src/lib.rs (target/debug/deps/soldier_core-72a3f3ad2c7b64d6)

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

     Running unittests src/lib.rs (target/debug/deps/soldier_infra-0e157a01c0072a71)

running 7 tests
test deribit::public::tests::falls_back_to_min_amount_when_amount_step_missing ... ok
test deribit::public::tests::deserializes_public_instrument_metadata ... ok
test health::tests::test_check_health_returns_healthy ... ok
test health::tests::test_exit_code_healthy ... ok
test health::tests::test_exit_code_unhealthy ... ok
test health::tests::test_healthy_response_has_required_fields ... ok
test health::tests::test_unhealthy_response_has_required_fields ... ok

test result: ok. 7 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

âœ“ rust gates passed

[0;32m=== 5) Optional gates (only when enabled) ===[0m
OK: VQ_EVIDENCE is reference-closed (each record has >=1 Contract ref and >=1 AT).
âœ“ venue evidence check passed
info: F1 cert present (status=PASS) [not required]
workflow acceptance required: changed workflow file: .github/workflows/ci.yml

[0;32m=== 6) Workflow acceptance (full) ===[0m

[0;32m===     using parallel runner with 4 workers ===[0m
Found 122 unique test IDs, sharding across 4 workers...
Launched 4 workers, waiting for completion...
Chunk 0: 31 tests (0..0k.20)
Chunk 1: 31 tests (0k.3..15c)
Chunk 2: 31 tests (15d..30.1)
Chunk 3: 29 tests (30.10..9)
Workflow acceptance mode: only-set:0,0a,0b,0c,0d,0d.1,0e,0f,0f.1,0f.2,0g,0h,0i,0j,0j.1,0j.2,0j.3,0k,0k.1,0k.10,0k.11,0k.12,0k.13,0k.14,0k.15,0k.16,0k.17,0k.18,0k.19,0k.2,0k.20
workflow_acceptance_mode=full
State file: /tmp/wa_state_0_14917
Status file: /tmp/wa_status_0_14917
Workflow acceptance mode: only-set:30.10,30.11,30.12,30.13,30.14,30.2,30.3,30.4,30.4b,30.4c,30.4d,30.4e,30.4f,30.5,30.6,30.7,30.8,30.9,3b,4,5,5a,5b,5c,5d,6,7,8,9
workflow_acceptance_mode=full
State file: /tmp/wa_state_3_14917
Status file: /tmp/wa_status_3_14917
Workflow acceptance mode: only-set:15d,16,16b,16c,17,18,19,2,20,21,22,23,24,25,26,27,28,28.1,28.2,28.3,29,2b,2c,2d,2e,2f,2g,2h,3,30,30.1
workflow_acceptance_mode=full
State file: /tmp/wa_state_2_14917
Status file: /tmp/wa_status_2_14917
Workflow acceptance mode: only-set:0k.3,0k.4,0k.5,0k.6,0k.7,0k.8,0k.9,0l,0m,0n,0n.1,1,10,10b,10c,10c.1,10d,10e,11,12,12b,12c,12d,13,14,14b,14c,14d,15,15b,15c
workflow_acceptance_mode=full
State file: /tmp/wa_state_1_14917
Status file: /tmp/wa_status_1_14917
workflow acceptance mode: clone
workflow acceptance mode: clone
workflow acceptance mode: clone
workflow acceptance mode: clone
Test 0d.1: git hook env vars are cleared for workflow acceptance
PASS 0d.1 (1s)
Test 0e: optional overlay files are skipped when missing
PASS 0e (0s)
Test 0f.1: ssot lint
Test 0k.3: contract coverage matrix fixtures
PASS 0k.3 (4s)
Test 0k.4: workflow acceptance clone fallback
SSOT_LINT_OK
PASS 0f.1 (15s)
Test 0f.2: verify includes spec integrity gates
PASS 0f.2 (1s)
Test 2: attempted pass flip without verify_post is prevented
Test 0f: prd_pipeline logs skipped ref check
Test 3b: COMPLETE mention does not trigger blocked_incomplete
PASS 0k.4 (17s)
Test 0k.5: contract kernel check
PASS 0k.5 (2s)
Test 0k.6: contract kernel sources hash aligned
PASS 0k.6 (1s)
Test 0k.7: contract kernel file present
PASS 0k.7 (1s)
Test 0k.8: verify.sh parallel primitives structure
PASS 0k.8 (5s)
Test 0k.9: verify.sh parallel acceptance integration marker
PASS 0k.9 (1s)
Test 0l: --list prints test ids
PASS 0l (2s)
Test 0m: state/status files update
PASS 0m (0s)
Test 0n: selector flags work for --only/--resume
PASS 0f (25s)
Test 0g: manifest written on preflight block
PASS 0g (9s)
Test 0h: real PRD schema check (plans/prd.json)
PASS 0h (1s)
Test 0i: PRD self-dependency check
PASS 0i (1s)
Test 0j: shell safety checks (bash -n, shellcheck optional)
SKIP: shellcheck not installed
PASS 0j (1s)
Test 0j.1: autofix script syntax check
PASS 0j.1 (1s)
Test 0j.2: autofix run_fix escalates on tool failure
PASS 0j.2 (2s)
Test 0j.3: autofix evidence survives escalation
PASS 0j.3 (2s)
Test 0k: workflow preflight checks
PASS 2 (61s)
Test 2b: mark_pass without meaningful change is blocked
PASS 3b (69s)
Test 4: invalid selection writes verify_pre.log (best effort)
PASS 0k (27s)
Test 0k.1: prd gate fixtures
PASS 4 (24s)
Test 5: lock prevents concurrent runs
PASS 5 (8s)
Test 5a: stale lock auto-clears
PASS 0n (81s)
Test 0n.1: selector flags work for --only-set
PASS 2b (52s)
Test 2c: mark_pass promotes verify mode
PASS 5a (20s)
Test 5b: git identity is set when missing
PASS 5b (24s)
Test 5c: preflight blocks without timeout or python3
PASS 5c (21s)
Test 5d: contract review sees iteration artifacts
PASS 0k.1 (109s)
Test 0k.2: prd audit check fixtures
PASS 0k.2 (14s)
Test 0k.10: verify.sh run_parallel_group uses array expansion not eval
PASS 0k.10 (1s)
Test 0k.11: Reject --only-set with empty tokens
PASS 0k.11 (1s)
Test 0k.12: Reject empty or comment-only allowlist
PASS 0k.12 (1s)
Test 0k.13: PRD cache integration tests
=== PRD Cache Integration Tests ===
PASS 2c (93s)
Test 2d: update_task requires promotion verify mode
PASS: TC7: corrupt digest caused exit 2
PASS: TC8: missing slice detected (exit 1)
Cache updated for slice 1: PASS
PASS: TC6: float counts handled correctly
PASS 0n.1 (105s)
Cache updated for slice 1: BLOCKED
PASS 2d (7s)
Test 2e: explore profile forbids mark_pass
PASS: TC9: BLOCKED invalidates cache entry
PASS: TC10: lock contention caused exit 7

=== Summary: 5 passed, 0 failed ===
PASS 0k.13 (10s)
Test 0k.14: Global invariants Appendix A referenced
PASS 0k.14 (1s)
Test 0k.15: workflow acceptance cache wiring
PASS 0k.15 (0s)
Test 0k.16: workflow allowlist coverage
Test 1: schema-violating PRD stops preflight
PASS 1 (13s)
PASS 0k.16 (20s)
Test 0k.17: change detection routing
Test 10: decision=PASS with ALLOW pass flip completes
workflow acceptance required: changed workflow file: plans/verify.sh
PASS 0k.17 (1s)
Test 0k.18: verify.sh census flags
[1;33mWARN: non_tty_default_off: VERIFY_CHECKPOINT_ROLLOUT unset in non-TTY context; forcing rollout=off[0m
[1;33mWARN: non_tty_default_off: VERIFY_CHECKPOINT_ROLLOUT unset in non-TTY context; forcing rollout=off[0m
PASS 0k.18 (12s)
Test 0k.19: preflight census passthrough
[1;33mWARN: non_tty_default_off: VERIFY_CHECKPOINT_ROLLOUT unset in non-TTY context; forcing rollout=off[0m
[1;33mWARN: non_tty_default_off: VERIFY_CHECKPOINT_ROLLOUT unset in non-TTY context; forcing rollout=off[0m
PASS 0k.19 (14s)
PASS 2e (56s)
Test 0k.20: PRD includes S1-012 F1 cert tooling
Test 2f: promote profile requires promotion verify
PASS 0k.20 (2s)
PASS 5d (108s)
PASS 2f (9s)
Test 6: missing contract_check.sh writes FAIL contract review
Test 2g: run_ralph ignores inherited RPH_VERIFY_MODE
Test 0a: auditor cache skip avoids agent call
PASS 0a (8s)
Test 0b: slice preflight warns but continues on unresolved refs
PASS 0b (12s)
Test 0c: ref check blocks unresolved refs
PASS 0c (4s)
Test 0d: ref check resolves slash + parenthetical variants
PASS 0d (6s)
Test 0: contract_check resolves contract refs without SIGPIPE
PASS 0 (34s)
PASS 10 (135s)
Workflow acceptance tests passed
Test 10e: postmortem-only changes do not bypass pass flip guard
PASS 6 (113s)
Test 7: invalid contract_review.json is rewritten to FAIL
PASS 10e (47s)
Test 10b: final verify uses RPH_FINAL_VERIFY_MODE
PASS 2g (152s)
Test 2h: ralph verify artifacts ignored by ralph_dir_modified guard
PASS 7 (62s)
Test 8: decision=BLOCKED stops iteration
PASS 10b (86s)
Test 10c: final verify disabled writes SKIPPED manifest
PASS 8 (72s)
Test 9: decision=FAIL stops iteration
PASS 2h (101s)
Test 3: COMPLETE printed early blocks with blocked_incomplete artifact
PASS 10c (74s)
Test 10c.1: update_task blocks non-promotion verify
PASS 3 (66s)
PASS 9 (75s)
Test 15d: dependency cycle blocks selection
Test 30.2: schema fail-closed for missing/malformed schema artifact and malformed skip_cache
PASS 30.2 (5s)
Test 30.3: checkpoint no-downgrade guard rejects lower target version
PASS 30.3 (1s)
Test 30.4: enforce mode uses cache-hit skip and dry_run reports would-skip
PASS 15d (20s)
Test 16: cheating detected (deleted test file)
PASS 30.4 (16s)
Test 30.4b: gate input hash cache persists within shell
PASS 30.4b (1s)
Test 30.4c: override fingerprint ignores run-id artifacts
PASS 30.4c (1s)
Test 30.4d: spec validator hash covers core inputs
PASS 30.4d (0s)
Test 30.4e: checkpoint tool versions use PYTHON_BIN
PASS 30.4e (2s)
Test 30.4f: override fingerprint tracks GLOBAL_INVARIANTS_FILE
PASS 30.4f (3s)
Test 30.5: local full verify requires approval
PASS 30.5 (1s)
Test 30.6: pre-push uses quick unless local full approved
Running verify.sh before push...
Pushing to protected branch: refs/heads/main
WARN: local full verify disabled; running quick and relying on CI
Verification passed, proceeding with push...
Running verify.sh before push...
Pushing to protected branch: refs/heads/main
Running full verification...
Verification passed, proceeding with push...
PASS 30.6 (6s)
Test 30.7: fingerprint-manifest lint detects undeclared env keys
PASS 30.7 (12s)
Test 30.8: lock_and_policy fail-closed checks
PASS 10c.1 (85s)
Test 10d: final verify failure writes FAIL manifest
PASS 30.8 (15s)
Test 30.9: reset_verify_checkpoint enforces lock policy and force override
PASS 30.9 (8s)
Test 30.10: checkpoint age and hash-budget guards fail closed
PASS 30.10 (6s)
Test 30.11: opportunity telemetry writes jsonl and prunes deterministically
PASS 30.11 (10s)
Test 30.12: verify_skip_status helper reports effective policy and checkpoint fields
PASS 16 (88s)
PASS 30.12 (3s)
Test 16b: harness tamper blocks before processing
Test 30.13: check_sample_mix helper parses telemetry diagnostics
PASS 30.13 (3s)
Test 30.14: spec validators group fails closed on malformed or too-short list
FAIL: malformed spec validator line (expected name|timeout|command): bad_line_without_separators
FAIL: validator list suspiciously short (1 < MIN_SPEC_VALIDATORS=7)
PASS 30.14 (1s)
Workflow acceptance tests passed
PASS 16b (35s)
Test 16c: .ralph tamper blocks before processing
PASS 10d (91s)
Test 11: contract_review_validate enforces schema file
PASS 11 (4s)
Test 12: workflow contract traceability gate
PASS 16c (42s)
Test 17: active slice gating selects lowest slice
PASS 17 (12s)
Test 18: rate limit sleep updates state and cooldown
PASS 18 (41s)
Test 19: circuit breaker blocks after repeated verify_post failure
PASS 12 (171s)
Test 12b: required workflow artifacts are present
PASS 12b (0s)
Test 12c: missing required workflow artifact fails fast
FAIL: required workflow artifact missing: plans/workflow_contract_map.json
PASS 12c (0s)
Test 12d: workflow contract gate validates enforcement existence
PASS 19 (94s)
Test 20: max iterations exceeded
12d timing: missing_enforcement 25s
12d timing: unknown_test_id 67s
12d timing: valid_test_refs 76s
PASS 20 (179s)
Test 21: self-heal reverts bad changes
12d timing: invalid_range 61s
12d timing: duplicate_spec_ids 2s
12d timing: duplicate_map_ids 1s
PASS 12d (236s)
Test 13: missing PRD file stops preflight
PASS 13 (6s)
Test 14: verify_pre failure stops before implementation
PASS 21 (66s)
Test 22: allowlist_check rejects missing entries
PASS 22 (1s)
Test 23: allowlist_check passes when all entries present
PASS 23 (2s)
Test 24: allowlist_check --format json produces valid JSON
PASS 24 (2s)
Test 25: allowlist_lint detects duplicates
PASS 25 (1s)
Test 26: allowlist_lint passes on clean file
PASS 26 (1s)
Test 27: prd_preflight runs gate and allowlist check (smoke mode)
PASS 14 (20s)
Test 14b: verify output is tailed and summary created
PASS 27 (12s)
Test 28: prd_preflight --strict fails when allowlist script missing
PASS 28 (1s)
Test 28.1: preflight --strict succeeds with resolvable BASE_REF
PASS 28.1 (3s)
Test 28.2: preflight --strict fails on missing BASE_REF
PASS 28.2 (2s)
Test 28.3: preflight exits 2 on missing required file
PASS 28.3 (2s)
Test 29: allowlist_suggest generates patch
PASS 14b (17s)
Test 14c: bootstrap mode skips verify_pre when workspace missing
PASS 29 (2s)
Test 30: checkpoint skip entrypoint guard scaffold
PASS 30 (2s)
Test 30.1: rollout invalid value fails closed to off
[1;33mWARN: rollout_invalid_value: VERIFY_CHECKPOINT_ROLLOUT='enforcee' forced to off[0m
PASS 30.1 (1s)
Workflow acceptance tests passed
PASS 14c (79s)
Test 14d: bootstrap mode still runs verify_pre when workspace present
PASS 14d (22s)
Test 15: needs_human_decision=true blocks execution
PASS 15 (15s)
Test 15b: dependency schema rejects forward-slice dependency
PASS 15b (1s)
Test 15c: dependency ordering respects same-slice deps
PASS 15c (13s)
Workflow acceptance tests passed
All workers completed successfully
âœ“ workflow acceptance passed (full)

[0;32m=== Timing Summary ===[0m
  arch_flows: 1s
  contract_crossrefs: 2s
  crash_matrix: 1s
  crash_replay_idempotency: 0s
  csp_trace: 0s
  global_invariants: 0s
  parallel_smoke: 6s
  postmortem_check: 1s
  preflight: 2s
  reconciliation_matrix: 0s
  rust_fmt: 3s
  rust_tests_quick: 26s
  state_machines: 1s
  status_fixture_market_data_stale: 2s
  status_fixture_partial_fill_containment: 2s
  status_fixture_restart_reconcile: 2s
  status_fixture_session_termination: 2s
  status_fixture_unknown_token_force_kill: 2s
  status_fixture_wal_backpressure: 1s
  time_freshness: 1s
  vendor_docs_lint_rust: 1s
  workflow_acceptance: 1454s

[0;32m=== VERIFY OK (mode=quick) ===[0m


=== STDERR ===
[1;33mWARN: non_tty_default_off: VERIFY_CHECKPOINT_ROLLOUT unset in non-TTY context; forcing rollout=off[0m
[1;33mWARN: checkpoint_hash_target_missed: phase=2000ms target=500ms[0m
[1;33mWARN: Skipping clippy in quick mode[0m

