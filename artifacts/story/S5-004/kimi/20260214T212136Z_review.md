# Kimi review

- Story: S5-004
- Timestamp (UTC): 20260214T212136Z
- Branch: story/S5-004/fma-guards
- HEAD: 8899d6fa7aef0f1c6a1a76aff96ddb8a5a454837
- Model: claude-opus-4.6
- Mode: failure-mode-analysis

---

## Review Scope

7 failure-mode guard fixes from phase 1 analysis. 21 files changed, +734/-97.

## Findings (ordered by severity)

### Blocking: none

### Major: none

### Medium

1. **TLSM cross-crate sync is comment-only** (cache.rs / tlsm.rs / ledger.rs)
   - `TlsState::is_valid_successor()` whitelist in soldier_infra must be manually kept in sync with `Tlsm::apply()` in soldier_core.
   - Mitigated by `test_tlsm_wal_whitelist_sync` exhaustive test in test_ledger_replay.rs.
   - Risk: developer adds transition to tlsm.rs but forgets to update ledger.rs. Test catches it at CI time.

### Low

1. **Indistinguishable ratio error source** (quantize.rs)
   - `QuantizeError::InvalidInput { field: "ratio" }` is returned for both NaN and non-finite inputs. The `field` value doesn't distinguish between NaN price vs NaN quantity causing the ratio to be non-finite.
   - Impact: debugging only; the error message could be more specific.

## Disposition

No blocking or major findings. Medium finding has mechanical test enforcement. Low finding is cosmetic.
