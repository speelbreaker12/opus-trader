# DRIFT_RISKS.md — Ralph Repository Drift Risks

Generated: 2026-01-27

---

## Critical Drift Risks

### 1. CONTRACT.md Copies (RESOLVED)

**Current State:** CLEAN
- Single canonical: `specs/CONTRACT.md`
- Root `CONTRACT.md` correctly deleted
- `ssot_lint.sh` enforces single-copy rule

**Evidence:**
```
ssot_lint.sh:44: [[ -f "CONTRACT.md" ]] && fail "Root CONTRACT.md is forbidden"
ssot_lint.sh:69-70: CONTRACT.md must exist only at specs/CONTRACT.md
```

**Risk:** LOW (enforcement exists)

---

### 2. IMPLEMENTATION_PLAN.md Duplication

**Current State:** DRIFT RISK
- Canonical: `specs/IMPLEMENTATION_PLAN.md`
- Root stub: **MISSING** (required by `ssot_lint.sh:42`)

**Evidence:**
```
ssot_lint.sh:42: check_stub "IMPLEMENTATION_PLAN.md" "specs/IMPLEMENTATION_PLAN.md"
# This will fail if root stub is missing
```

**Risk:** MEDIUM
**Fix:** Create root stub:
```markdown
# IMPLEMENTATION_PLAN.md (redirect stub)

CANONICAL SOURCE OF TRUTH:
- specs/IMPLEMENTATION_PLAN.md

Do not edit this file. Update the canonical file only.
```

---

### 3. verify.sh Duplication (RESOLVED)

**Current State:** CLEAN
- Root `verify.sh` is a proper redirect stub
- Canonical implementation: `plans/verify.sh`
- `AGENTS.md` documents the relationship

**Evidence:**
```bash
# verify.sh (root)
exec "$ROOT/plans/verify.sh" "$@"
```
```markdown
# AGENTS.md:82-84
There is also a `./verify.sh` at repo root. **DO NOT edit or reference it**
All workflow gating must target **`plans/verify.sh`**.
```

**Risk:** LOW (enforcement exists)

---

### 4. Contract Digest Duplication

**Potential Drift:**
- `docs/contract_kernel.json` — derived from CONTRACT.md
- `docs/contract_anchors.md` — manual annotations
- `docs/validation_rules.md` — manual rules

**Risk:** MEDIUM
- Kernel is derived but could drift if not regenerated
- No automatic drift detection

**Fix:** Add CI check that kernel hash matches CONTRACT.md hash

---

### 5. docs/bundle_CONTRACT_PHASE1.md

**Current State:** DRIFT RISK
- 688-line excerpt of CONTRACT.md
- No automation to keep in sync
- Will diverge from `specs/CONTRACT.md`

**Evidence:**
```
wc -l:
  688 docs/bundle_CONTRACT_PHASE1.md
 5895 specs/CONTRACT.md
```

**Risk:** HIGH
**Fix:** DELETE (or add regeneration script tied to CONTRACT.md changes)

---

### 6. docs/PLAN_PHASE1_EXCERPT.md

**Current State:** DRIFT RISK
- Excerpt of IMPLEMENTATION_PLAN.md
- No automation to keep in sync

**Risk:** HIGH
**Fix:** DELETE (use specs/IMPLEMENTATION_PLAN.md directly)

---

### 7. to-do/CONTRACT_patched_*.md

**Current State:** STALE
- Old patched versions of CONTRACT.md
- Superseded by current `specs/CONTRACT.md`

**Evidence:**
```
to-do/CONTRACT_patched_with_CSP_appendix_CSP_ONLY_metaATs_with_CSP_mapping_preflight_fixes.md
to-do/CONTRACT_patched_with_CSP_appendix_CSP_ONLY_metaATs_with_CSP_mapping_preflight_fixes.diff
```

**Risk:** HIGH (confusing; may be referenced accidentally)
**Fix:** DELETE (changes already incorporated)

---

### 8. patches/*.patch

**Current State:** STALE
- Manual patch files for CSP changes
- Changes already applied to canonical files

**Evidence:**
```
patches/CSP-002_specs_IMPLEMENTATION_PLAN.md_Slice-1.patch
patches/CSP-003_specs_IMPLEMENTATION_PLAN.md_Slice-4.patch
(12 files total)
```

**Risk:** MEDIUM (no automation; may be applied twice)
**Fix:** DELETE or move to `attic/` with README noting "applied YYYY-MM-DD"

---

### 9. prompts/ Duplication

**Potential Drift:**
- `prompts/auditor.md` — used by `run_prd_auditor.sh`
- `prompts/Workflow_Auditor.md` — possibly duplicate?

**Evidence:**
```bash
# run_prd_auditor.sh
AUDITOR_PROMPT="${AUDITOR_PROMPT:-prompts/auditor.md}"
```

**Risk:** LOW (only auditor.md is wired)
**Fix:** DELETE `Workflow_Auditor.md` if unused

---

### 10. docs/architecture/ vs docs/codebase/

**Current State:** ORPHAN RISK
- Both directories contain architecture/codebase docs
- No inbound links to most files

**Evidence:**
```
ORPHAN: docs/architecture/system_map.md
ORPHAN: docs/codebase/architecture.md
ORPHAN: docs/codebase/concerns.md
ORPHAN: docs/codebase/conventions.md
ORPHAN: docs/codebase/integrations.md
ORPHAN: docs/codebase/stack.md
ORPHAN: docs/codebase/testing.md
```

**Risk:** MEDIUM (duplicate structure; will drift)
**Fix:** MERGE into single `docs/codebase/` and add links from AGENTS.md

---

## Drift Prevention Checklist

| Risk | Current Mitigation | Gap |
|------|-------------------|-----|
| CONTRACT.md copies | `ssot_lint.sh` enforces | None |
| IMPLEMENTATION_PLAN.md | `ssot_lint.sh` requires stub | Root stub missing |
| verify.sh copies | Root is proper stub | None |
| Contract kernel drift | None | Add hash check |
| Excerpt files drift | None | DELETE excerpts |
| Patch files stale | None | DELETE/archive |
| Docs structure | None | MERGE directories |

---

## Recommended Single-Source-of-Truth Fixes

1. **Create `IMPLEMENTATION_PLAN.md` stub at root**
2. **DELETE `docs/bundle_CONTRACT_PHASE1.md`**
3. **DELETE `docs/PLAN_PHASE1_EXCERPT.md`**
4. **DELETE `to-do/*.md` and `to-do/*.diff`**
5. **ARCHIVE `patches/*.patch` to `attic/2026-01-patches/`**
6. **MERGE `docs/architecture/` into `docs/codebase/`**
7. **ADD kernel hash check to CI**
