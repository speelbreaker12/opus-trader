{
  "project": "StoicTrader",
  "source": {
    "implementation_plan_path": "IMPLEMENTATION_PLAN.md",
    "contract_path": "CONTRACT.md"
  },
  "rules": {
    "one_story_per_iteration": true,
    "one_commit_per_story": true,
    "no_prd_rewrite": true,
    "passes_only_flips_after_verify_green": true,
    "contract_refs_required": true
  },
  "items": [
    {
      "id": "S1-000",
      "priority": 100,
      "phase": 1,
      "slice": 0,
      "slice_ref": "Bootstrap",
      "story_ref": "Setup",
      "category": "ops",
      "description": "Validate existing plans/verify.sh as the canonical verification script.",
      "scope": {
        "touch": [
          "plans/verify.sh"
        ],
        "avoid": [
          "crates/**"
        ]
      },
      "acceptance": [
        "plans/verify.sh exists and is executable",
        "plans/verify.sh runs successfully"
      ],
      "steps": [
        "Review existing plans/verify.sh contents against the CI gates",
        "Update plans/verify.sh if it diverges from the canonical CI gates",
        "Ensure plans/verify.sh is executable"
      ],
      "verify": [
        "bash -n plans/verify.sh",
        "chmod +x plans/verify.sh",
        "./plans/verify.sh"
      ],
      "evidence": [
        "Execution output of ./plans/verify.sh"
      ],
      "dependencies": [],
      "est_size": "XS",
      "risk": "low",
      "needs_human_decision": false,
      "passes": false,
      "contract_refs": [
        "CONTRACT.md (general)"
      ],
      "plan_refs": [
        "IMPLEMENTATION_PLAN.md §Slice 2: Quantization + Labeling + Idempotency"
      ]
    },
    {
      "id": "S1-001",
      "priority": 90,
      "phase": 1,
      "slice": 1,
      "slice_ref": "Slice 1",
      "story_ref": "S1.0",
      "category": "ops",
      "description": "Initialize Rust workspace with soldier_core and soldier_infra crates.",
      "scope": {
        "touch": [
          "Cargo.toml",
          "crates/soldier_core/**",
          "crates/soldier_infra/**",
          "plans/verify.sh"
        ],
        "avoid": [
          "src/**"
        ]
      },
      "acceptance": [
        "Workspace builds successfully",
        "Tests pass (empty test suite)"
      ],
      "steps": [
        "Create 'crates' directory",
        "Initialize 'crates/soldier_core' as a library",
        "Initialize 'crates/soldier_infra' as a library",
        "Create root 'Cargo.toml' defining the workspace",
        "Update 'plans/verify.sh' to run 'cargo test --workspace'"
      ],
      "verify": [
        "./plans/verify.sh"
      ],
      "evidence": [
        "Output of cargo test --workspace"
      ],
      "dependencies": [
        "S1-000"
      ],
      "est_size": "S",
      "risk": "low",
      "needs_human_decision": false,
      "passes": false,
      "contract_refs": [
        "CONTRACT.md (general)"
      ],
      "plan_refs": [
        "IMPLEMENTATION_PLAN.md §Slice 2: Quantization + Labeling + Idempotency"
      ]
    },
    {
      "id": "S1-002",
      "priority": 80,
      "phase": 1,
      "slice": 1,
      "slice_ref": "Slice 1",
      "story_ref": "S1.1",
      "category": "logic",
      "description": "Implement InstrumentKind derivation and RiskState definitions.",
      "scope": {
        "touch": [
          "crates/soldier_core/src/venue/**",
          "crates/soldier_core/src/risk/state.rs",
          "crates/soldier_infra/src/deribit/public/**"
        ],
        "avoid": [
          "crates/soldier_core/src/execution/**"
        ]
      },
      "acceptance": [
        "InstrumentKind derives correct enum variant from venue metadata",
        "Linear perpetuals (USDC-margined) map to linear_future",
        "RiskState enum exists with Normal and Degraded variants"
      ],
      "steps": [
        "Define 'RiskState' enum in 'crates/soldier_core/src/risk/state.rs'",
        "Define 'InstrumentKind' enum in 'crates/soldier_core/src/venue/types.rs'",
        "Define minimal Deribit public instrument structs in 'crates/soldier_infra'",
        "Implement conversion logic from Deribit instrument to 'InstrumentKind'",
        "Add unit tests in 'crates/soldier_core/tests/test_instrument_kind_mapping.rs'"
      ],
      "verify": [
        "./plans/verify.sh",
        "cargo test -p soldier_core --test test_instrument_kind_mapping"
      ],
      "evidence": [
        "Test output showing 'test_linear_perp_treated_as_linear_future' passing"
      ],
      "dependencies": [
        "S1-001"
      ],
      "est_size": "S",
      "risk": "low",
      "needs_human_decision": false,
      "passes": false,
      "contract_refs": [
        "CONTRACT.md (general)"
      ],
      "plan_refs": [
        "IMPLEMENTATION_PLAN.md §Slice 2: Quantization + Labeling + Idempotency"
      ]
    },
    {
      "id": "S1-003",
      "priority": 70,
      "phase": 1,
      "slice": 1,
      "slice_ref": "Slice 1",
      "story_ref": "S1.1",
      "category": "enforcement",
      "description": "Implement Instrument Cache with TTL and staleness enforcement.",
      "scope": {
        "touch": [
          "crates/soldier_core/src/venue/**"
        ],
        "avoid": [
          "crates/soldier_core/src/execution/**"
        ]
      },
      "acceptance": [
        "Instrument cache respects TTL",
        "Stale cache triggers RiskState::Degraded"
      ],
      "steps": [
        "Implement 'InstrumentCache' struct in 'crates/soldier_core/src/venue/cache.rs'",
        "Add TTL logic to cache retrieval",
        "Return 'RiskState::Degraded' when TTL is breached",
        "Add counter 'instrument_cache_stale_total'",
        "Add unit tests in 'crates/soldier_core/tests/test_instrument_cache_ttl.rs'"
      ],
      "verify": [
        "./plans/verify.sh",
        "cargo test -p soldier_core --test test_instrument_cache_ttl"
      ],
      "evidence": [
        "Test output showing 'test_stale_instrument_cache_sets_degraded' passing"
      ],
      "dependencies": [
        "S1-002"
      ],
      "est_size": "M",
      "risk": "med",
      "needs_human_decision": false,
      "passes": false,
      "contract_refs": [
        "CONTRACT.md (general)"
      ],
      "plan_refs": [
        "IMPLEMENTATION_PLAN.md §Slice 2: Quantization + Labeling + Idempotency"
      ]
    },
    {
      "id": "S1-004",
      "priority": 60,
      "phase": 1,
      "slice": 1,
      "slice_ref": "Slice 1",
      "story_ref": "S1.2",
      "category": "logic",
      "description": "Implement OrderSize canonical sizing logic.",
      "scope": {
        "touch": [
          "crates/soldier_core/src/execution/order_size.rs"
        ],
        "avoid": [
          "crates/soldier_infra/**"
        ]
      },
      "acceptance": [
        "OrderSize struct implemented with contracts, qty_coin, qty_usd, notional_usd",
        "Canonical units derived correctly for options/futures (coin) vs perps (usd)",
        "notional_usd always populated"
      ],
      "steps": [
        "Create 'crates/soldier_core/src/execution/order_size.rs'",
        "Define 'OrderSize' struct",
        "Implement constructor/builder with canonical unit logic using 'InstrumentKind'",
        "Add log 'OrderSizeComputed'",
        "Add unit tests in 'crates/soldier_core/tests/test_order_size.rs'"
      ],
      "verify": [
        "./plans/verify.sh",
        "cargo test -p soldier_core --test test_order_size"
      ],
      "evidence": [
        "Test output showing 'test_order_size_option_perp_canonical_amount' passing"
      ],
      "dependencies": [
        "S1-002"
      ],
      "est_size": "S",
      "risk": "low",
      "needs_human_decision": false,
      "passes": false,
      "contract_refs": [
        "CONTRACT.md (general)"
      ],
      "plan_refs": [
        "IMPLEMENTATION_PLAN.md §Slice 2: Quantization + Labeling + Idempotency"
      ]
    },
    {
      "id": "S1-005",
      "priority": 50,
      "phase": 1,
      "slice": 1,
      "slice_ref": "Slice 1",
      "story_ref": "S1.3",
      "category": "enforcement",
      "description": "Implement Dispatcher amount mapping and mismatch enforcement.",
      "scope": {
        "touch": [
          "crates/soldier_core/src/execution/dispatch_map.rs"
        ],
        "avoid": [
          "crates/soldier_core/src/risk/**"
        ]
      },
      "acceptance": [
        "Outbound request maps to exactly one canonical amount field",
        "Mismatch between contracts and canonical amount rejects intent",
        "Mismatch triggers RiskState::Degraded"
      ],
      "steps": [
        "Create 'crates/soldier_core/src/execution/dispatch_map.rs'",
        "Implement mapping logic from 'OrderSize' to outbound request fields",
        "Add validation: if both contracts and canonical amount exist and mismatch, return error and Degraded state",
        "Add counter 'order_intent_reject_unit_mismatch_total'",
        "Add unit tests in 'crates/soldier_core/tests/test_dispatch_map.rs'",
        "Add unit tests in 'crates/soldier_core/tests/test_order_size.rs' for mismatch degradation"
      ],
      "verify": [
        "./plans/verify.sh",
        "cargo test -p soldier_core --test test_dispatch_map",
        "cargo test -p soldier_core --test test_order_size"
      ],
      "evidence": [
        "Test output showing 'test_dispatch_amount_field_coin_vs_usd' and 'test_order_size_mismatch_rejects_and_degrades' passing"
      ],
      "dependencies": [
        "S1-004",
        "S1-003"
      ],
      "est_size": "M",
      "risk": "med",
      "needs_human_decision": false,
      "passes": false,
      "contract_refs": [
        "CONTRACT.md (general)"
      ],
      "plan_refs": [
        "IMPLEMENTATION_PLAN.md §Slice 2: Quantization + Labeling + Idempotency"
      ]
    }
  ]
}
