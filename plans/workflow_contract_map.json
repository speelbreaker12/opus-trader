{
  "schema_version": "1.0",
  "rules": [
    {
      "id": "WF-0.1",
      "title": "Trading behavior precedence",
      "enforcement": [
        "Human: contract review + agent instructions"
      ],
      "artifacts": [
        "CONTRACT.md",
        "plans/progress.txt"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-0.2",
      "title": "Workflow contract is canonical",
      "enforcement": [
        "Human: change control"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-1.1",
      "title": "CONTRACT.md required",
      "enforcement": [
        "plans/init.sh",
        "plans/ralph.sh preflight"
      ],
      "artifacts": [
        "CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-1.2",
      "title": "IMPLEMENTATION_PLAN.md required",
      "enforcement": [
        "plans/init.sh",
        "plans/ralph.sh preflight"
      ],
      "artifacts": [
        "IMPLEMENTATION_PLAN.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-1.3",
      "title": "plans/prd.json required",
      "enforcement": [
        "plans/init.sh",
        "plans/ralph.sh preflight"
      ],
      "artifacts": [
        "plans/prd.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 12)"
      ]
    },
    {
      "id": "WF-1.4",
      "title": "plans/ralph.sh required",
      "enforcement": [
        "Human: harness invocation"
      ],
      "artifacts": [
        "plans/ralph.sh"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-1.5",
      "title": "plans/verify.sh required",
      "enforcement": [
        "plans/init.sh",
        "plans/ralph.sh preflight"
      ],
      "artifacts": [
        "plans/verify.sh"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-1.6",
      "title": "plans/progress.txt required",
      "enforcement": [
        "plans/init.sh",
        "plans/ralph.sh progress_gate"
      ],
      "artifacts": [
        "plans/progress.txt"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 9)"
      ]
    },
    {
      "id": "WF-2.1",
      "title": "Contract alignment mandatory",
      "enforcement": [
        "plans/contract_check.sh",
        "plans/ralph.sh needs_human_decision gate"
      ],
      "artifacts": [
        ".ralph/iter_*/contract_review.json",
        ".ralph/blocked_*"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Tests 6-8)"
      ]
    },
    {
      "id": "WF-2.2",
      "title": "Verification mandatory",
      "enforcement": [
        "plans/ralph.sh verify_pre/verify_post",
        "plans/prd_schema_check.sh",
        "plans/update_task.sh"
      ],
      "artifacts": [
        ".ralph/iter_*/verify_pre.log",
        ".ralph/iter_*/verify_post.log",
        ".ralph/state.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 2)"
      ]
    },
    {
      "id": "WF-2.3",
      "title": "WIP=1 (one story + one commit)",
      "enforcement": [
        "plans/ralph.sh selection",
        "plans/contract_check.sh commit count"
      ],
      "artifacts": [
        ".ralph/iter_*/selected.json",
        ".ralph/iter_*/contract_review.json"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-2.4",
      "title": "Slices executed in order",
      "enforcement": [
        "plans/ralph.sh ACTIVE_SLICE selection"
      ],
      "artifacts": [
        ".ralph/iter_*/selected.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 16)"
      ]
    },
    {
      "id": "WF-2.5",
      "title": "No cheating",
      "enforcement": [
        "plans/ralph.sh detect_cheating"
      ],
      "artifacts": [
        ".ralph/iter_*/diff_for_cheat_check.patch"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 15)"
      ]
    },
    {
      "id": "WF-2.6",
      "title": "Fail closed with diagnostic artifacts",
      "enforcement": [
        "plans/ralph.sh write_blocked_*"
      ],
      "artifacts": [
        ".ralph/blocked_*/blocked_item.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Tests 1-8)"
      ]
    },
    {
      "id": "WF-3.0",
      "title": "PRD applies only to Ralph loop (workflow maintenance outside PRD)",
      "enforcement": [
        "Human: workflow policy"
      ],
      "artifacts": [
        "plans/prd.json",
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-3.1",
      "title": "PRD JSON shape",
      "enforcement": [
        "plans/prd_schema_check.sh"
      ],
      "artifacts": [
        "plans/prd.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 1)"
      ]
    },
    {
      "id": "WF-3.2",
      "title": "PRD top-level keys required",
      "enforcement": [
        "plans/prd_schema_check.sh"
      ],
      "artifacts": [
        "plans/prd.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 1)"
      ]
    },
    {
      "id": "WF-3.3",
      "title": "Per-item required fields + acceptance/steps/verify",
      "enforcement": [
        "plans/prd_schema_check.sh"
      ],
      "artifacts": [
        "plans/prd.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 1)"
      ]
    },
    {
      "id": "WF-3.4",
      "title": "needs_human_decision requires human_blocker",
      "enforcement": [
        "plans/prd_schema_check.sh"
      ],
      "artifacts": [
        "plans/prd.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 1)"
      ]
    },
    {
      "id": "WF-3.5",
      "title": "PRD item required fields list",
      "enforcement": [
        "plans/prd_schema_check.sh"
      ],
      "artifacts": [
        "plans/prd.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 1)"
      ]
    },
    {
      "id": "WF-3.6",
      "title": "human_blocker schema",
      "enforcement": [
        "plans/prd_schema_check.sh"
      ],
      "artifacts": [
        "plans/prd.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 1)"
      ]
    },
    {
      "id": "WF-4.1",
      "title": "Story Cutter responsibilities",
      "enforcement": [
        "Human: Story Cutter process"
      ],
      "artifacts": [
        "plans/prd.json"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-4.2",
      "title": "Auditor outputs",
      "enforcement": [
        "Human: Auditor process"
      ],
      "artifacts": [
        "plans/prd_audit.json"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-4.3",
      "title": "PRD patcher constraints",
      "enforcement": [
        "Human: PRD patcher process",
        "plans/ralph.sh blocks agent PRD edits"
      ],
      "artifacts": [
        "plans/prd.json"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-4.4",
      "title": "Implementer duties",
      "enforcement": [
        "plans/ralph.sh prompt + progress_gate + commit check"
      ],
      "artifacts": [
        "plans/progress.txt",
        ".ralph/iter_*/agent.out"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 9)"
      ]
    },
    {
      "id": "WF-4.5",
      "title": "Contract Arbiter",
      "enforcement": [
        "plans/contract_check.sh"
      ],
      "artifacts": [
        ".ralph/iter_*/contract_review.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Tests 6-8)"
      ]
    },
    {
      "id": "WF-4.6",
      "title": "Handoff hygiene",
      "enforcement": [
        "Human: implementer/maintainer"
      ],
      "artifacts": [
        "plans/progress.txt",
        "docs/codebase/*",
        "plans/ideas.md",
        "plans/pause.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-4.7",
      "title": "Workflow skill memory is manual-only",
      "enforcement": [
        "Human: maintain docs/skills/workflow.md"
      ],
      "artifacts": [
        "docs/skills/workflow.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.0",
      "title": "Ralph is the only allowed automation",
      "enforcement": [
        "Human: workflow policy"
      ],
      "artifacts": [
        "plans/ralph.sh"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.1",
      "title": "Preflight invariants",
      "enforcement": [
        "plans/ralph.sh preflight"
      ],
      "artifacts": [
        ".ralph/blocked_*"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Tests 1,5,12)"
      ]
    },
    {
      "id": "WF-5.2",
      "title": "Active slice gating",
      "enforcement": [
        "plans/ralph.sh select_next_item"
      ],
      "artifacts": [
        ".ralph/iter_*/selected.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 16)"
      ]
    },
    {
      "id": "WF-5.3",
      "title": "Selection modes + validation",
      "enforcement": [
        "plans/ralph.sh selection logic"
      ],
      "artifacts": [
        ".ralph/iter_*/selected.json",
        ".ralph/iter_*/selection.out"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 4)"
      ]
    },
    {
      "id": "WF-5.4",
      "title": "Hard stop on needs_human_decision",
      "enforcement": [
        "plans/ralph.sh needs_human_decision gate"
      ],
      "artifacts": [
        ".ralph/blocked_*"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 14)"
      ]
    },
    {
      "id": "WF-5.5",
      "title": "verify_pre / verify_post gates",
      "enforcement": [
        "plans/ralph.sh run_verify"
      ],
      "artifacts": [
        ".ralph/iter_*/verify_pre.log",
        ".ralph/iter_*/verify_post.log"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 2)"
      ]
    },
    {
      "id": "WF-5.5.1",
      "title": "Endpoint-level test gate",
      "enforcement": [
        "plans/verify.sh endpoint gate"
      ],
      "artifacts": [
        "plans/verify.sh output"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.6",
      "title": "Story verify requirement gate",
      "enforcement": [
        "plans/ralph.sh verify[] contains ./plans/verify.sh"
      ],
      "artifacts": [
        ".ralph/blocked_*"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 1)"
      ]
    },
    {
      "id": "WF-5.7",
      "title": "Story verify allowlist gate",
      "enforcement": [
        "plans/ralph.sh run_story_verify"
      ],
      "artifacts": [
        "plans/story_verify_allowlist.txt",
        ".ralph/iter_*/story_verify.log"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.8",
      "title": "Optional self-heal",
      "enforcement": [
        "plans/ralph.sh self-heal"
      ],
      "artifacts": [
        ".ralph/last_good_ref",
        ".ralph/iter_*/verify_pre_after_heal.log"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 18)"
      ]
    },
    {
      "id": "WF-5.9",
      "title": "Completion conditions",
      "enforcement": [
        "plans/ralph.sh completion_requirements_met"
      ],
      "artifacts": [
        ".ralph/blocked_incomplete_*",
        ".ralph/final_verify_*.log"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 3)"
      ]
    },
    {
      "id": "WF-5.10",
      "title": "Scope enforcement gate",
      "enforcement": [
        "plans/ralph.sh scope_gate"
      ],
      "artifacts": [
        ".ralph/blocked_*"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-5.11",
      "title": "Rate limiting + circuit breaker",
      "enforcement": [
        "plans/ralph.sh rate_limit_before_call",
        "plans/ralph.sh circuit breaker"
      ],
      "artifacts": [
        ".ralph/rate_limit.json",
        ".ralph/state.json",
        ".ralph/blocked_*"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-6.1",
      "title": "Iteration artifacts required",
      "enforcement": [
        "plans/ralph.sh save_iter_* + verify_iteration_artifacts"
      ],
      "artifacts": [
        ".ralph/iter_*/*"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 9)"
      ]
    },
    {
      "id": "WF-6.2",
      "title": "Blocked artifacts required",
      "enforcement": [
        "plans/ralph.sh write_blocked_*"
      ],
      "artifacts": [
        ".ralph/blocked_*/blocked_item.json",
        ".ralph/blocked_*/verify_pre.log"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Tests 1-5)"
      ]
    },
    {
      "id": "WF-6.3",
      "title": "Optional diagnostics",
      "enforcement": [
        "plans/ralph.sh (optional writes)"
      ],
      "artifacts": [
        ".ralph/iter_*/story_verify.log",
        ".ralph/iter_*/diff_for_cheat_check.patch"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-7.1",
      "title": "Contract check after verify_post green",
      "enforcement": [
        "plans/ralph.sh ensure_contract_review"
      ],
      "artifacts": [
        ".ralph/iter_*/contract_review.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Tests 6-8)"
      ]
    },
    {
      "id": "WF-7.2",
      "title": "contract_review.json must be produced",
      "enforcement": [
        "plans/contract_check.sh"
      ],
      "artifacts": [
        ".ralph/iter_*/contract_review.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Tests 6-8)"
      ]
    },
    {
      "id": "WF-7.3",
      "title": "contract_review.json must conform to schema",
      "enforcement": [
        "plans/contract_review_validate.sh"
      ],
      "artifacts": [
        "docs/schemas/contract_review.schema.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 10)"
      ]
    },
    {
      "id": "WF-7.4",
      "title": "Fail-closed triggers",
      "enforcement": [
        "Human: review policy"
      ],
      "artifacts": [
        "plans/contract_check.sh"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-8.1",
      "title": "CI executes verify.sh",
      "enforcement": [
        "CI config"
      ],
      "artifacts": [
        ".github/workflows/*"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-8.2",
      "title": "verify.sh prints VERIFY_SH_SHA",
      "enforcement": [
        "plans/verify.sh"
      ],
      "artifacts": [
        "plans/verify.sh output"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 4)"
      ]
    },
    {
      "id": "WF-8.3",
      "title": "Ralph captures VERIFY_SH_SHA",
      "enforcement": [
        "plans/ralph.sh verify_log_has_sha"
      ],
      "artifacts": [
        ".ralph/iter_*/verify_pre.log",
        ".ralph/iter_*/verify_post.log"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 4)"
      ]
    },
    {
      "id": "WF-8.4",
      "title": "CI logs contain VERIFY_SH_SHA",
      "enforcement": [
        "CI config"
      ],
      "artifacts": [
        "CI logs/artifacts"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-8.5",
      "title": "verify.sh CI gate source check",
      "enforcement": [
        "plans/verify.sh CI_GATES_SOURCE check"
      ],
      "artifacts": [
        "plans/verify.sh output"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-9.1",
      "title": "Progress log required fields",
      "enforcement": [
        "plans/ralph.sh progress_gate"
      ],
      "artifacts": [
        "plans/progress.txt",
        ".ralph/iter_*/progress_appended.txt"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 9)"
      ]
    },
    {
      "id": "WF-10.1",
      "title": "Human unblock protocol",
      "enforcement": [
        "Human: read blocked artifacts"
      ],
      "artifacts": [
        ".ralph/blocked_*/blocked_item.json"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-11.1",
      "title": "Change control",
      "enforcement": [
        "Human: update workflow contract first"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-11.2",
      "title": "Workflow maintenance honors contract alignment + verification",
      "enforcement": [
        "Human: change control",
        "plans/verify.sh"
      ],
      "artifacts": [
        "specs/WORKFLOW_CONTRACT.md",
        "plans/verify.sh"
      ],
      "tests": [
        "manual"
      ]
    },
    {
      "id": "WF-12.1",
      "title": "Acceptance: preflight/PRD validation",
      "enforcement": [
        "plans/workflow_acceptance.sh"
      ],
      "artifacts": [
        ".ralph/blocked_*"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Tests 1,12)"
      ]
    },
    {
      "id": "WF-12.2",
      "title": "Acceptance: baseline integrity",
      "enforcement": [
        "plans/workflow_acceptance.sh"
      ],
      "artifacts": [
        ".ralph/iter_*/verify_pre.log"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 13)"
      ]
    },
    {
      "id": "WF-12.3",
      "title": "Acceptance: pass flipping integrity",
      "enforcement": [
        "plans/workflow_acceptance.sh"
      ],
      "artifacts": [
        ".ralph/iter_*/verify_post.log",
        ".ralph/iter_*/contract_review.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Tests 2,6-9)"
      ]
    },
    {
      "id": "WF-12.4",
      "title": "Acceptance: slice gating/blocked behavior",
      "enforcement": [
        "plans/workflow_acceptance.sh"
      ],
      "artifacts": [
        ".ralph/blocked_*",
        ".ralph/iter_*/selected.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Tests 14,15,16)"
      ]
    },
    {
      "id": "WF-12.5",
      "title": "Acceptance: completion semantics",
      "enforcement": [
        "plans/workflow_acceptance.sh"
      ],
      "artifacts": [
        ".ralph/blocked_incomplete_*"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 3)"
      ]
    },
    {
      "id": "WF-12.6",
      "title": "Acceptance: anti-spin",
      "enforcement": [
        "plans/workflow_acceptance.sh"
      ],
      "artifacts": [
        ".ralph/blocked_*"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 17)"
      ]
    },
    {
      "id": "WF-12.7",
      "title": "Acceptance: verify SHA observability",
      "enforcement": [
        "plans/workflow_acceptance.sh"
      ],
      "artifacts": [
        ".ralph/iter_*/verify_pre.log",
        ".ralph/iter_*/verify_post.log"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 4)"
      ]
    },
    {
      "id": "WF-12.8",
      "title": "Traceability gate",
      "enforcement": [
        "plans/workflow_contract_gate.sh"
      ],
      "artifacts": [
        "plans/workflow_contract_map.json"
      ],
      "tests": [
        "plans/workflow_acceptance.sh (Test 11)"
      ]
    }
  ]
}
